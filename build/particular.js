var x=[];for(let e=0;e<256;e++)x[e]=(e<16?"0":"")+e.toString(16);var tt=1234567,st=Math.PI/180,it=180/Math.PI;function at(){let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(x[e&255]+x[e>>8&255]+x[e>>16&255]+x[e>>24&255]+"-"+x[t&255]+x[t>>8&255]+"-"+x[t>>16&15|64]+x[t>>24&255]+"-"+x[s&63|128]+x[s>>8&255]+"-"+x[s>>16&255]+x[s>>24&255]+x[i&255]+x[i>>8&255]+x[i>>16&255]+x[i>>24&255]).toLowerCase()}function S(e,t,s){return Math.max(t,Math.min(s,e))}function et(e,t){return(e%t+t)%t}function ot(e,t,s,i,r){return i+(e-t)*(r-i)/(s-t)}function ct(e,t,s){return e!==t?(s-e)/(t-e):0}function rt(e,t,s){return(1-s)*e+s*t}function lt(e,t,s,i){return rt(e,t,1-Math.exp(-s*i))}function ut(e,t=1){return t-Math.abs(et(e,t*2)-t)}function dt(e,t=0,s=1){return e<=t?0:e>=s?1:(e=(e-t)/(s-t),e*e*(3-2*e))}function ft(e,t=0,s=1){return e<=t?0:e>=s?1:(e=(e-t)/(s-t),e*e*e*(e*(e*6-15)+10))}function mt(e,t){return e+Math.floor(Math.random()*(t-e+1))}function yt(e,t){return e+Math.random()*(t-e)}function xt(e){return e*(.5-Math.random())}function pt(e){e!==void 0&&(tt=e);let t=tt+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function zt(e){return e*st}function _t(e){return e*it}function gt(e){return(e&e-1)===0&&e!==0}function wt(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Mt(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function bt(e,t,s,i,r){let h=Math.cos,d=Math.sin,n=h(s/2),l=d(s/2),a=h((t+i)/2),o=d((t+i)/2),u=h((t-i)/2),f=d((t-i)/2),c=h((i-t)/2),y=d((i-t)/2);switch(r){case"XYX":e.set(n*o,l*u,l*f,n*a);break;case"YZY":e.set(l*f,n*o,l*u,n*a);break;case"ZXZ":e.set(l*u,l*f,n*o,n*a);break;case"XZX":e.set(n*o,l*y,l*c,n*a);break;case"YXY":e.set(l*c,n*o,l*y,n*a);break;case"ZYZ":e.set(l*y,l*c,n*o,n*a);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function St(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Ct(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}var C={DEG2RAD:st,RAD2DEG:it,generateUUID:at,clamp:S,euclideanModulo:et,mapLinear:ot,inverseLerp:ct,lerp:rt,damp:lt,pingpong:ut,smoothstep:dt,smootherstep:ft,randInt:mt,randFloat:yt,randFloatSpread:xt,seededRandom:pt,degToRad:zt,radToDeg:_t,isPowerOfTwo:gt,ceilPowerOfTwo:wt,floorPowerOfTwo:Mt,setQuaternionFromProperEuler:bt,normalize:Ct,denormalize:St};var w=class{constructor(t=0,s=0,i=0,r=1){this._x=t,this._y=s,this._z=i,this._w=r}static slerp(t,s,i,r){return console.warn("Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,s,r)}static slerpFlat(t,s,i,r,h,d,n){let l=i[r+0],a=i[r+1],o=i[r+2],u=i[r+3],f=h[d+0],c=h[d+1],y=h[d+2],k=h[d+3];if(n===0){t[s+0]=l,t[s+1]=a,t[s+2]=o,t[s+3]=u;return}if(n===1){t[s+0]=f,t[s+1]=c,t[s+2]=y,t[s+3]=k;return}if(u!==k||l!==f||a!==c||o!==y){let g=1-n,E=l*f+a*c+o*y+u*k,J=E>=0?1:-1,$=1-E*E;if($>Number.EPSILON){let _=Math.sqrt($),O=Math.atan2(_,E*J);g=Math.sin(g*O)/_,n=Math.sin(n*O)/_}let F=n*J;if(l=l*g+f*F,a=a*g+c*F,o=o*g+y*F,u=u*g+k*F,g===1-n){let _=1/Math.sqrt(l*l+a*a+o*o+u*u);l*=_,a*=_,o*=_,u*=_}}t[s]=l,t[s+1]=a,t[s+2]=o,t[s+3]=u}static multiplyQuaternionsFlat(t,s,i,r,h,d){let n=i[r],l=i[r+1],a=i[r+2],o=i[r+3],u=h[d],f=h[d+1],c=h[d+2],y=h[d+3];return t[s]=n*y+o*u+l*c-a*f,t[s+1]=l*y+o*f+a*u-n*c,t[s+2]=a*y+o*c+n*f-l*u,t[s+3]=o*y-n*u-l*f-a*c,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,s,i,r){return this._x=t,this._y=s,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,s){if(!(t&&t.isEuler))throw new Error("Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let i=t._x,r=t._y,h=t._z,d=t._order,n=Math.cos,l=Math.sin,a=n(i/2),o=n(r/2),u=n(h/2),f=l(i/2),c=l(r/2),y=l(h/2);switch(d){case"XYZ":this._x=f*o*u+a*c*y,this._y=a*c*u-f*o*y,this._z=a*o*y+f*c*u,this._w=a*o*u-f*c*y;break;case"YXZ":this._x=f*o*u+a*c*y,this._y=a*c*u-f*o*y,this._z=a*o*y-f*c*u,this._w=a*o*u+f*c*y;break;case"ZXY":this._x=f*o*u-a*c*y,this._y=a*c*u+f*o*y,this._z=a*o*y+f*c*u,this._w=a*o*u-f*c*y;break;case"ZYX":this._x=f*o*u-a*c*y,this._y=a*c*u+f*o*y,this._z=a*o*y-f*c*u,this._w=a*o*u+f*c*y;break;case"YZX":this._x=f*o*u+a*c*y,this._y=a*c*u+f*o*y,this._z=a*o*y-f*c*u,this._w=a*o*u-f*c*y;break;case"XZY":this._x=f*o*u-a*c*y,this._y=a*c*u-f*o*y,this._z=a*o*y+f*c*u,this._w=a*o*u+f*c*y;break;default:console.warn("Quaternion: .setFromEuler() encountered an unknown order: "+d)}return s!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,s){let i=s/2,r=Math.sin(i);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){let s=t.elements,i=s[0],r=s[4],h=s[8],d=s[1],n=s[5],l=s[9],a=s[2],o=s[6],u=s[10],f=i+n+u;if(f>0){let c=.5/Math.sqrt(f+1);this._w=.25/c,this._x=(o-l)*c,this._y=(h-a)*c,this._z=(d-r)*c}else if(i>n&&i>u){let c=2*Math.sqrt(1+i-n-u);this._w=(o-l)/c,this._x=.25*c,this._y=(r+d)/c,this._z=(h+a)/c}else if(n>u){let c=2*Math.sqrt(1+n-i-u);this._w=(h-a)/c,this._x=(r+d)/c,this._y=.25*c,this._z=(l+o)/c}else{let c=2*Math.sqrt(1+u-i-n);this._w=(d-r)/c,this._x=(h+a)/c,this._y=(l+o)/c,this._z=.25*c}return this._onChangeCallback(),this}setFromUnitVectors(t,s){let i=t.dot(s)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*s.z-t.z*s.y,this._y=t.z*s.x-t.x*s.z,this._z=t.x*s.y-t.y*s.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(S(this.dot(t),-1,1)))}rotateTowards(t,s){let i=this.angleTo(t);if(i===0)return this;let r=Math.min(1,s/i);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,s){return s!==void 0?(console.warn("Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,s)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,s){let i=t._x,r=t._y,h=t._z,d=t._w,n=s._x,l=s._y,a=s._z,o=s._w;return this._x=i*o+d*n+r*a-h*l,this._y=r*o+d*l+h*n-i*a,this._z=h*o+d*a+i*l-r*n,this._w=d*o-i*n-r*l-h*a,this._onChangeCallback(),this}slerp(t,s){if(s===0)return this;if(s===1)return this.copy(t);let i=this._x,r=this._y,h=this._z,d=this._w,n=d*t._w+i*t._x+r*t._y+h*t._z;if(n<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,n=-n):this.copy(t),n>=1)return this._w=d,this._x=i,this._y=r,this._z=h,this;let l=1-n*n;if(l<=Number.EPSILON){let c=1-s;return this._w=c*d+s*this._w,this._x=c*i+s*this._x,this._y=c*r+s*this._y,this._z=c*h+s*this._z,this.normalize(),this._onChangeCallback(),this}let a=Math.sqrt(l),o=Math.atan2(a,n),u=Math.sin((1-s)*o)/a,f=Math.sin(s*o)/a;return this._w=d*u+this._w*f,this._x=i*u+this._x*f,this._y=r*u+this._y*f,this._z=h*u+this._z*f,this._onChangeCallback(),this}slerpQuaternions(t,s,i){return this.copy(t).slerp(s,i)}random(){let t=Math.random(),s=Math.sqrt(1-t),i=Math.sqrt(t),r=2*Math.PI*Math.random(),h=2*Math.PI*Math.random();return this.set(s*Math.cos(r),i*Math.sin(h),i*Math.cos(h),s*Math.sin(r))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,s=0){return this._x=t[s],this._y=t[s+1],this._z=t[s+2],this._w=t[s+3],this._onChangeCallback(),this}toArray(t=[],s=0){return t[s]=this._x,t[s+1]=this._y,t[s+2]=this._z,t[s+3]=this._w,t}fromBufferAttribute(t,s){return this._x=t.getX(s),this._y=t.getY(s),this._z=t.getZ(s),this._w=t.getW(s),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}};w.prototype.isQuaternion=!0;var m=class{constructor(t=0,s=0,i=0){this.x=t,this.y=s,this.z=i}set(t,s,i){return i===void 0&&(i=this.z),this.x=t,this.y=s,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,s){switch(t){case 0:this.x=s;break;case 1:this.y=s;break;case 2:this.z=s;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,s){return s!==void 0?(console.warn("Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,s)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,s){return this.x=t.x+s.x,this.y=t.y+s.y,this.z=t.z+s.z,this}addScaledVector(t,s){return this.x+=t.x*s,this.y+=t.y*s,this.z+=t.z*s,this}sub(t,s){return s!==void 0?(console.warn("Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,s)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,s){return this.x=t.x-s.x,this.y=t.y-s.y,this.z=t.z-s.z,this}multiply(t,s){return s!==void 0?(console.warn("Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,s)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,s){return this.x=t.x*s.x,this.y=t.y*s.y,this.z=t.z*s.z,this}applyEuler(t){return t&&t.isEuler||console.error("Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(nt.setFromEuler(t))}applyAxisAngle(t,s){return this.applyQuaternion(nt.setFromAxisAngle(t,s))}applyMatrix3(t){let s=this.x,i=this.y,r=this.z,h=t.elements;return this.x=h[0]*s+h[3]*i+h[6]*r,this.y=h[1]*s+h[4]*i+h[7]*r,this.z=h[2]*s+h[5]*i+h[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let s=this.x,i=this.y,r=this.z,h=t.elements,d=1/(h[3]*s+h[7]*i+h[11]*r+h[15]);return this.x=(h[0]*s+h[4]*i+h[8]*r+h[12])*d,this.y=(h[1]*s+h[5]*i+h[9]*r+h[13])*d,this.z=(h[2]*s+h[6]*i+h[10]*r+h[14])*d,this}applyQuaternion(t){let s=this.x,i=this.y,r=this.z,h=t.x,d=t.y,n=t.z,l=t.w,a=l*s+d*r-n*i,o=l*i+n*s-h*r,u=l*r+h*i-d*s,f=-h*s-d*i-n*r;return this.x=a*l+f*-h+o*-n-u*-d,this.y=o*l+f*-d+u*-h-a*-n,this.z=u*l+f*-n+a*-d-o*-h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let s=this.x,i=this.y,r=this.z,h=t.elements;return this.x=h[0]*s+h[4]*i+h[8]*r,this.y=h[1]*s+h[5]*i+h[9]*r,this.z=h[2]*s+h[6]*i+h[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,s){return this.x=Math.max(t.x,Math.min(s.x,this.x)),this.y=Math.max(t.y,Math.min(s.y,this.y)),this.z=Math.max(t.z,Math.min(s.z,this.z)),this}clampScalar(t,s){return this.x=Math.max(t,Math.min(s,this.x)),this.y=Math.max(t,Math.min(s,this.y)),this.z=Math.max(t,Math.min(s,this.z)),this}clampLength(t,s){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(s,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,s){return this.x+=(t.x-this.x)*s,this.y+=(t.y-this.y)*s,this.z+=(t.z-this.z)*s,this}lerpVectors(t,s,i){return this.x=t.x+(s.x-t.x)*i,this.y=t.y+(s.y-t.y)*i,this.z=t.z+(s.z-t.z)*i,this}cross(t,s){return s!==void 0?(console.warn("Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,s)):this.crossVectors(this,t)}crossVectors(t,s){let i=t.x,r=t.y,h=t.z,d=s.x,n=s.y,l=s.z;return this.x=r*l-h*n,this.y=h*d-i*l,this.z=i*n-r*d,this}projectOnVector(t){let s=t.lengthSq();if(s===0)return this.set(0,0,0);let i=t.dot(this)/s;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return j.copy(this).projectOnVector(t),this.sub(j)}reflect(t){return this.sub(j.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let s=Math.sqrt(this.lengthSq()*t.lengthSq());if(s===0)return Math.PI/2;let i=this.dot(t)/s;return Math.acos(S(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let s=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return s*s+i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,s,i){let r=Math.sin(s)*t;return this.x=r*Math.sin(i),this.y=Math.cos(s)*t,this.z=r*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,s,i){return this.x=t*Math.sin(s),this.y=i,this.z=t*Math.cos(s),this}setFromMatrixPosition(t){let s=t.elements;return this.x=s[12],this.y=s[13],this.z=s[14],this}setFromMatrixScale(t){let s=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=s,this.y=i,this.z=r,this}setFromMatrixColumn(t,s){return this.fromArray(t.elements,s*4)}setFromMatrix3Column(t,s){return this.fromArray(t.elements,s*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,s=0){return this.x=t[s],this.y=t[s+1],this.z=t[s+2],this}toArray(t=[],s=0){return t[s]=this.x,t[s+1]=this.y,t[s+2]=this.z,t}fromBufferAttribute(t,s,i){return i!==void 0&&console.warn("Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(s),this.y=t.getY(s),this.z=t.getZ(s),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=(Math.random()-.5)*2,s=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(s),this.y=i*Math.sin(s),this.z=t,this}limit(t=1){this.lengthSq()>t*t&&this.setLength(t)}constrainX(t=0,s=0){this.x<t&&(this.x=t),this.x>s&&(this.x=s)}constrainY(t=0,s=0){this.y<t&&(this.y=t),this.y>s&&(this.y=s)}constrainZ(t=0,s=0){this.z<t&&(this.z=t),this.z>s&&(this.z=s)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};m.prototype.isVector3=!0;var j=new m,nt=new w;var p=(e,t=1)=>{e.lengthSq()>t*t&&e.setLength(t)},G=(e,t=0,s=0)=>{e.x<t&&(e.x=t),e.x>s&&(e.x=s)},K=(e,t=0,s=0)=>{e.y<t&&(e.y=t),e.y>s&&(e.y=s)},W=(e,t=0,s=0)=>{e.z<t&&(e.z=t),e.z>s&&(e.z=s)},Vt={limit:p,constrainX:G,constrainY:K,constrainZ:W};var z=new m,D=class{constructor({distance:t=50,maxSpeed:s=3,maxForce:i=.05}={}){this.distance=t,this.maxSpeed=s,this.maxForce=i,this.enabled=!0,this.weight=1}apply(t){if(this.enabled){let s=this.align(t);t.addForce(s)}}align(t){z.set(0,0,0);let s=0,i=this.distance*this.distance;return t.neighbors.forEach(r=>{if(r!==t){let h=t.distanceToSquared(r);h>0&&h<i&&(z.add(r.getVelocity()),s++)}}),s>0&&z.multiplyScalar(1/s),z.lengthSq()>0&&(z.setLength(this.maxSpeed),z.sub(t.getVelocity()),p(z,this.maxForce)),this.weight!==1&&z.multiplyScalar(this.weight),z}};var A=class{constructor({target:t=new m,maxSpeed:s=3.5,maxForce:i=.5,maxDistance:r=100}={}){this.target=t,this.maxSpeed=s,this.maxForce=i,this.maxDistance=r,this.enabled=!0,this.weight=1}apply(t){if(this.enabled){let s=this.seek(t);t.addForce(s)}}seek(t){let s=new m().copy(t);s.sub(this.target);let i=s.length();return i<this.maxDistance?s.setLength(this.maxSpeed*(1-i/this.maxDistance)):s.set(0,0,0),s.sub(t.getVelocity()),p(s,this.maxForce),this.weight!==1&&s.multiplyScalar(this.weight),s}};var P=class{constructor({min:t=new m(-1,-1,-1),max:s=new m(1,1,1)}={}){this.min=t,this.max=s,this.enabled=!0}apply(t){this.enabled&&(t.x<=this.min.x&&(t.x=this.min.x,t.velocity.x*=-1),t.y<=this.min.y&&(t.y=this.min.y,t.velocity.y*=-1),t.z<=this.min.z&&this.min.z!==this.max.z&&(t.z=this.min.z,t.velocity.z*=-1),t.x>=this.max.x&&(t.x=this.max.x,t.velocity.x*=-1),t.y>=this.max.y&&(t.y=this.max.y,t.velocity.y*=-1),t.z>=this.max.z&&this.min.z!==this.max.z&&(t.z=this.max.z,t.velocity.z*=-1),this.min.z===this.max.z&&(t.z=this.max.z,t.velocity.z=0))}};var V=new m,v=new m,q=new m,I=class{constructor({distance:t=50,maxSpeed:s=3,maxForce:i=.05}={}){this.distance=t,this.maxSpeed=s,this.maxForce=i,this.enabled=!0,this.weight=1}apply(t){if(this.enabled){let s=this.cohesion(t);t.addForce(s)}}cohesion(t){V.set(0,0,0);let s=0,i=this.distance*this.distance;return t.neighbors.forEach(r=>{if(r!==t){let h=t.distanceToSquared(r);h>0&&h<i&&(V.add(r),s++)}}),s>0?(V.multiplyScalar(1/s),this.seek(V,t)):V}seek(t,s){return v.copy(t).sub(s),v.setLength(this.maxSpeed),q.copy(v).sub(s.getVelocity()),p(q,this.maxForce),this.weight!==1&&q.multiplyScalar(this.weight),q}};var L=new m,X=class{constructor({offset:t=0,maxForce:s=.2}={}){this.offset=t,this.maxForce=s,this.enabled=!0,this.weight=1}apply(t){if(this.enabled){let s=new m,i=1,r=this.offset===0?t.radius:t.radius*(1-this.offset);t.neighbors.forEach(h=>{if(h!==t&&!h.noCollision){L.copy(t),L.sub(h);let d=L.length(),n=r+h.radius;if(d<n){let l=L.setLength((n-d)/n);s.add(l),i++}}}),s.multiplyScalar(1/i),p(s,this.maxForce),this.weight!==1&&s.multiplyScalar(this.weight),t.addForce(s)}}};var Y=class{constructor({min:t=new m(-1,-1,-1),max:s=new m(1,1,1)}={}){this.min=t,this.max=s,this.enabled=!0}apply(t){this.enabled&&(t.x<=this.min.x&&(t.x=this.min.x),t.y<=this.min.y&&(t.y=this.min.y),t.z<=this.min.z&&(t.z=this.min.z),t.x>=this.max.x&&(t.x=this.max.x),t.y>=this.max.y&&(t.y=this.max.y),t.z>=this.max.z&&(t.z=this.max.z))}};var Q=class extends EventTarget{constructor({target:t=new m,maxSpeed:s=3.5,maxForce:i=.5,minDistance:r=0,slowDownDistance:h=100,easing:d=void 0,arriveEnabled:n=!1,arriveDistance:l=.01}={}){super(),this.target=t,this.maxSpeed=s,this.maxForce=i,this.minDistance=r,this.slowDownDistance=h,this.easing=d,this.arriveEnabled=n,this.arriveDistance=l,this.enabled=!0,this.arrived=!1,this.weight=1,this.seekStarted=!1}apply(t){if(this.enabled){let s=this.seek(t);t.addForce(s)}}seek(t){let s=new m().copy(this.target).sub(t),i=s.length();if(i>this.minDistance){if(i<this.minDistance+this.slowDownDistance){let r=(i-this.minDistance)/this.slowDownDistance;this.easing!==void 0&&this.easing!==null?s.setLength(this.maxSpeed*this.easing(r)):s.setLength(this.maxSpeed*r)}else s.setLength(this.maxSpeed);s.sub(t.getVelocity()),p(s,this.maxForce)}else s.set(0,0,0);if(this.arriveEnabled){let r=i<this.arriveDistance;!r&&(this.arrived||!this.seekStarted)&&(this.dispatchEvent(new Event("start")),this.seekStarted=!0),r&&!this.arrived&&this.dispatchEvent(new Event("arrive")),this.arrived=r}return this.weight!==1&&s.multiplyScalar(this.weight),s}};var T=class{constructor({maxSpeed:t=3.5,maxForce:s=.5,min:i=new m(-10,-10,-10),max:r=new m(10,10,10),minDistance:h=.01,slowDownDistance:d=0}={}){this.maxSpeed=t,this.maxForce=s,this.min=i,this.max=r,this.minDistance=h<s?s:h,this.slowDownDistance=d,this.enabled=!0,this.weight=1,this.setRandomTarget()}apply(t){if(this.enabled){let s=this.seek(t);t.addForce(s)}}seek(t){let s=new m().copy(this.target);s.sub(t);let i=s.length();return i<=this.minDistance?this.setRandomTarget():i<this.slowDownDistance?s.setLength(this.maxSpeed*i/this.slowDownDistance):s.setLength(this.maxSpeed),s.sub(t.getVelocity()),p(s,this.maxForce),this.weight!==1&&s.multiplyScalar(this.weight),s}setRandomTarget(){this.target=new m(C.randFloat(this.min.x,this.max.x),C.randFloat(this.min.y,this.max.y),C.randFloat(this.min.z,this.max.z))}};var Z=new m,U=class{constructor({distance:t=25,maxSpeed:s=3,maxForce:i=.05}={}){this.distance=t,this.maxSpeed=s,this.maxForce=i,this.enabled=!0,this.weight=1}apply(t){if(this.enabled){let s=this.seperate(t);t.addForce(s)}}seperate(t){let s=new m,i=0;return t.neighbors.forEach(r=>{if(r!==t){let h=t.distanceTo(r);h>0&&h<this.distance&&(Z.copy(t),Z.sub(r),Z.setLength(1/h),s.add(Z),i++)}}),i>0&&s.multiplyScalar(1/i),s.lengthSq()>0&&(s.setLength(this.maxSpeed),s.sub(t.getVelocity()),p(s,this.maxForce)),this.weight!==1&&s.multiplyScalar(this.weight),s}};var H=class{constructor({speed:t=1,maxChange:s=1,maxForce:i=1}={}){this.speed=t,this.maxChange=s,this.maxForce=i,this.wanderVelocity=new m,this.wanderDirection=new m,this.enabled=!0,this.weight=1}apply(t){if(this.enabled){let s=this.wander();t.addForce(s)}}wander(){return this.wanderDirection.normalize(),this.wanderDirection.x+=(Math.random()-.5)*this.maxChange,this.wanderDirection.y+=(Math.random()-.5)*this.maxChange,this.wanderDirection.z+=(Math.random()-.5)*this.maxChange,this.wanderVelocity.set(0,0,0),this.wanderVelocity.add(this.wanderDirection),this.wanderVelocity.multiplyScalar(this.speed),p(this.wanderVelocity,this.maxForce),this.weight!==1&&this.wanderVelocity.multiplyScalar(this.weight),this.wanderVelocity}};var N=class{constructor({min:t=new m(-1,-1,-1),max:s=new m(1,1,1)}={}){this.min=t,this.max=s,this.enabled=!0}apply(t){this.enabled&&(t.x<this.min.x&&(t.x=this.max.x),t.y<this.min.y&&(t.y=this.max.y),t.z<this.min.z&&(t.z=this.max.z),t.x>this.max.x&&(t.x=this.min.x),t.y>this.max.y&&(t.y=this.min.y),t.z>this.max.z&&(t.z=this.min.z))}};var M=class{constructor({neighborRange:t=100}={}){this.neighborRange=t,this.H=new Map,this.particles=new Set}getXr(t){return Math.floor(t.x/this.neighborRange)}getYr(t){return Math.floor(t.y/this.neighborRange)}getKey(t){return this.getXr(t)+"_"+this.getYr(t)}add(t){this.particles.add(t),this.insert(t)}clear(){this.H.clear(),this.particles.clear()}insert(t){let s=this.getKey(t);if(this.H.get(s)===void 0)this.H.set(s,[t]);else{let i=this.H.get(s);i.push(t),this.H.set(s,i)}}updateAll(){this.H.clear(),this.particles.forEach(t=>{this.insert(t)})}check(t){let s=this.getXr(t),i=this.getYr(t),r=[],h=0;for(let n=s-1;n<=s+1;n++)for(let l=i-1;l<=i+1;l++)r[h++]=n+"_"+l;let d=[];for(h=0;h<r.length;h++)this.H.get(r[h])!==void 0&&(d=d.concat(this.H.get(r[h])));return new Set(d)}delete(t){let s=this.getKey(t);this.H.delete(s),this.particles.delete(t)}size(){return this.H.size}};var R=class extends m{constructor(t=0,s=0,i=0,r=1,h=1){super(t,s,i),this.locked=!1,this.behaviors=null,this.neighbors=null,this.mass=r,this.radius=h,this.friction=0,this.maxSpeed=3,this.force=new m,this.velocity=new m,this.velocitySmooth=new m,this.followers=new Set}addBehavior(t,s=!1){return this.behaviors===null&&(this.behaviors=new Set),(!this.behaviors.has(t)||s)&&this.behaviors.add(t),this}getBehavior(t){if(this.behaviors!==null){for(let s of this.behaviors)if(s instanceof t)return s}return null}addFollower(t){this.followers.add(t)}addForce(t){return this.force.add(t),this}applyBehaviors(){this.behaviors!==null&&this.behaviors.forEach(t=>{t.apply(this)})}applyForce(t){this.velocity.add(this.force.multiplyScalar(Math.min(t,1)/this.mass)),this.velocity.limit(this.maxSpeed),this.add(this.velocity),this.velocitySmooth.lerp(this.velocity,.05),this.force.set(0,0,0)}clearForce(){return this.force.set(0,0,0),this}clearVelocity(){return this.velocity.set(0,0,0),this}getVelocity(){return this.velocity}scaleVelocity(t){return this.velocity.multiplyScalar(t),this}removeBehavior(t){if(this.behaviors!==null){let s=this.behaviors.has(t);return this.behaviors.delete(t),s}else return!1}removeFollower(t){if(this.followers!==null){let s=this.followers.has(t);return this.followers.delete(t),s}else return!1}unlock(){return this.clearVelocity(),this.locked=!1,this}update(t){this.locked||(this.applyBehaviors(),this.applyForce(t)),this.scaleVelocity(1-this.friction),this.followers.forEach(s=>{s.copy(this)})}equalsWithTolerance(t,s){let i=this.x-t.x;return!(isNaN(i)||(i<0?-i:i)>s||(i=this.y-t.y,isNaN(i))||(i<0?-i:i)>s||(i=this.z-t.z,isNaN(i))||(i<0?-i:i)>s)}constrainX(t,s){G(this,t,s)}constrainY(t,s){K(this,t,s)}constrainZ(t,s){W(this,t,s)}};var b=class{constructor({friction:t=.95,springIterationsCount:s=50}={}){this.behaviors=new Set,this.constraints=new Set,this.groups=new Set,this.particles=new Set,this.springs=new Set,this.friction=t,this.springIterationsCount=s}addBehavior(t){this.behaviors.add(t)}addParticle(t){return this.returnIfConstrained(t)}addSpring(t){return this.getSpring(t.a,t.b)===null&&this.springs.add(t),this}addConstraint(t){return this.constraints.add(t),t}addGroup(t){return this.groups.add(t)}clear(){return this.particles.clear(),this.springs.clear(),this}getParticle(t){return this.returnIfConstrained(t)}getSpring(t,s){return this.springs.forEach(i=>{if(i.a===t&&i.b===s||i.a===s&&i.b===t)return i}),null}getnumConnected(t){let s=0;return this.springs!=null&&this.springs.forEach(i=>{(i.a===t||i.b===t)&&s++}),s}hasBehavior(t){return this.behaviors.has(t)}hasConstraint(t){return this.constraints.has(t)}hasGroup(t){return this.groups.has(t)}hasParticle(t){return this.particles.has(t)}hasSpring(t){return this.springs.has(t)}removeBehavior(t){return this.behaviors.delete(t)}removeConstraint(t){return this.constraints.delete(t)}removeParticle(t){return this.particles.delete(t)}removeSpring(t){return this.springs.delete(t)}removeSpringElements(t){return this.removeSpring(t)?this.removeParticle(t.a)&&this.removeParticle(t.b):!1}removeGroup(t){return this.groups.delete(t)}updateParticles(t){this.particles.forEach(s=>{s.neighbors===null&&(s.neighbors=this.particles),this.behaviors.forEach(i=>{i.apply(s)}),s.scaleVelocity(1-this.friction),s.update(t)})}updateSprings(t){if(this.springs!==null)for(let s=this.springIterationsCount;s>0;s--)this.springs.forEach(i=>{i.update(t)})}update(t=1){this.updateParticles(t),this.updateSprings(t),this.groups!==null&&this.groups.forEach(s=>{s.update(t)})}returnIfConstrained(t){return this.constraints.forEach(s=>{if(t.equalsWithTolerance(s,.1))return s}),this.returnIfDuplicate(t)}returnIfDuplicate(t){return this.particles.forEach(s=>{if(t===s)return s}),this.particles.add(t),t}};var B=class extends b{constructor(t){let{neighborRange:s=80}=t;super(t),this.hashgrid=new M({neighborRange:s}),this.neighborsCountAverage=0,this.batchSize=100,this.start=0}addParticle(t){let s=super.addParticle(t);return this.hashgrid.add(s),s}clear(){return super.clear(),this.hashgrid.clear(),this}removeParticle(t){return this.hashgrid.delete(t),super.removeParticle(t)}update(t=1){this.hashgrid.updateAll(),this.neighborsCountAverage=0,this.particles.forEach(s=>{s.neighbors=this.hashgrid.check(s),this.neighborsCountAverage+=s.neighbors.size}),this.neighborsCountAverage/=this.particles.size,this.neighborsCountAverage=Math.round(this.neighborsCountAverage),super.update(t)}};export{D as Align,A as Avoid,P as Bounce,I as Cohesion,X as Collision,Y as Constrain,B as GridPhysics,M as HashGrid,C as Math2,R as Particle,w as Quaternion,Q as Seek,T as SeekRandom,U as Separate,b as SimplePhysics,Vt as VecUtils,m as Vector3,H as Wander,N as Wrap};
//# sourceMappingURL=particular.js.map
