var y=[];for(let e=0;e<256;e++)y[e]=(e<16?"0":"")+e.toString(16);var tt=1234567,st=Math.PI/180,it=180/Math.PI;function ot(){let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(y[e&255]+y[e>>8&255]+y[e>>16&255]+y[e>>24&255]+"-"+y[t&255]+y[t>>8&255]+"-"+y[t>>16&15|64]+y[t>>24&255]+"-"+y[s&63|128]+y[s>>8&255]+"-"+y[s>>16&255]+y[s>>24&255]+y[i&255]+y[i>>8&255]+y[i>>16&255]+y[i>>24&255]).toLowerCase()}function S(e,t,s){return Math.max(t,Math.min(s,e))}function et(e,t){return(e%t+t)%t}function at(e,t,s,i,h){return i+(e-t)*(h-i)/(s-t)}function ct(e,t,s){return e!==t?(s-e)/(t-e):0}function rt(e,t,s){return(1-s)*e+s*t}function lt(e,t,s,i){return rt(e,t,1-Math.exp(-s*i))}function ut(e,t=1){return t-Math.abs(et(e,t*2)-t)}function dt(e,t=0,s=1){return e<=t?0:e>=s?1:(e=(e-t)/(s-t),e*e*(3-2*e))}function xt(e,t=0,s=1){return e<=t?0:e>=s?1:(e=(e-t)/(s-t),e*e*e*(e*(e*6-15)+10))}function ft(e,t){return e+Math.floor(Math.random()*(t-e+1))}function mt(e,t){return e+Math.random()*(t-e)}function yt(e){return e*(.5-Math.random())}function pt(e){e!==void 0&&(tt=e);let t=tt+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function zt(e){return e*st}function _t(e){return e*it}function gt(e){return(e&e-1)===0&&e!==0}function wt(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Mt(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function bt(e,t,s,i,h){let r=Math.cos,d=Math.sin,n=r(s/2),l=d(s/2),o=r((t+i)/2),a=d((t+i)/2),u=r((t-i)/2),x=d((t-i)/2),c=r((i-t)/2),m=d((i-t)/2);switch(h){case"XYX":e.set(n*a,l*u,l*x,n*o);break;case"YZY":e.set(l*x,n*a,l*u,n*o);break;case"ZXZ":e.set(l*u,l*x,n*a,n*o);break;case"XZX":e.set(n*a,l*m,l*c,n*o);break;case"YXY":e.set(l*c,n*a,l*m,n*o);break;case"ZYZ":e.set(l*m,l*c,n*a,n*o);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+h)}}function St(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Ct(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}var C={DEG2RAD:st,RAD2DEG:it,generateUUID:ot,clamp:S,euclideanModulo:et,mapLinear:at,inverseLerp:ct,lerp:rt,damp:lt,pingpong:ut,smoothstep:dt,smootherstep:xt,randInt:ft,randFloat:mt,randFloatSpread:yt,seededRandom:pt,degToRad:zt,radToDeg:_t,isPowerOfTwo:gt,ceilPowerOfTwo:wt,floorPowerOfTwo:Mt,setQuaternionFromProperEuler:bt,normalize:Ct,denormalize:St};var w=class{constructor(t=0,s=0,i=0,h=1){this._x=t,this._y=s,this._z=i,this._w=h}static slerp(t,s,i,h){return console.warn("Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,s,h)}static slerpFlat(t,s,i,h,r,d,n){let l=i[h+0],o=i[h+1],a=i[h+2],u=i[h+3],x=r[d+0],c=r[d+1],m=r[d+2],k=r[d+3];if(n===0){t[s+0]=l,t[s+1]=o,t[s+2]=a,t[s+3]=u;return}if(n===1){t[s+0]=x,t[s+1]=c,t[s+2]=m,t[s+3]=k;return}if(u!==k||l!==x||o!==c||a!==m){let g=1-n,F=l*x+o*c+a*m+u*k,$=F>=0?1:-1,v=1-F*F;if(v>Number.EPSILON){let z=Math.sqrt(v),O=Math.atan2(z,F*$);g=Math.sin(g*O)/z,n=Math.sin(n*O)/z}let E=n*$;if(l=l*g+x*E,o=o*g+c*E,a=a*g+m*E,u=u*g+k*E,g===1-n){let z=1/Math.sqrt(l*l+o*o+a*a+u*u);l*=z,o*=z,a*=z,u*=z}}t[s]=l,t[s+1]=o,t[s+2]=a,t[s+3]=u}static multiplyQuaternionsFlat(t,s,i,h,r,d){let n=i[h],l=i[h+1],o=i[h+2],a=i[h+3],u=r[d],x=r[d+1],c=r[d+2],m=r[d+3];return t[s]=n*m+a*u+l*c-o*x,t[s+1]=l*m+a*x+o*u-n*c,t[s+2]=o*m+a*c+n*x-l*u,t[s+3]=a*m-n*u-l*x-o*c,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,s,i,h){return this._x=t,this._y=s,this._z=i,this._w=h,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,s){if(!(t&&t.isEuler))throw new Error("Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let i=t._x,h=t._y,r=t._z,d=t._order,n=Math.cos,l=Math.sin,o=n(i/2),a=n(h/2),u=n(r/2),x=l(i/2),c=l(h/2),m=l(r/2);switch(d){case"XYZ":this._x=x*a*u+o*c*m,this._y=o*c*u-x*a*m,this._z=o*a*m+x*c*u,this._w=o*a*u-x*c*m;break;case"YXZ":this._x=x*a*u+o*c*m,this._y=o*c*u-x*a*m,this._z=o*a*m-x*c*u,this._w=o*a*u+x*c*m;break;case"ZXY":this._x=x*a*u-o*c*m,this._y=o*c*u+x*a*m,this._z=o*a*m+x*c*u,this._w=o*a*u-x*c*m;break;case"ZYX":this._x=x*a*u-o*c*m,this._y=o*c*u+x*a*m,this._z=o*a*m-x*c*u,this._w=o*a*u+x*c*m;break;case"YZX":this._x=x*a*u+o*c*m,this._y=o*c*u+x*a*m,this._z=o*a*m-x*c*u,this._w=o*a*u-x*c*m;break;case"XZY":this._x=x*a*u-o*c*m,this._y=o*c*u-x*a*m,this._z=o*a*m+x*c*u,this._w=o*a*u+x*c*m;break;default:console.warn("Quaternion: .setFromEuler() encountered an unknown order: "+d)}return s!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,s){let i=s/2,h=Math.sin(i);return this._x=t.x*h,this._y=t.y*h,this._z=t.z*h,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){let s=t.elements,i=s[0],h=s[4],r=s[8],d=s[1],n=s[5],l=s[9],o=s[2],a=s[6],u=s[10],x=i+n+u;if(x>0){let c=.5/Math.sqrt(x+1);this._w=.25/c,this._x=(a-l)*c,this._y=(r-o)*c,this._z=(d-h)*c}else if(i>n&&i>u){let c=2*Math.sqrt(1+i-n-u);this._w=(a-l)/c,this._x=.25*c,this._y=(h+d)/c,this._z=(r+o)/c}else if(n>u){let c=2*Math.sqrt(1+n-i-u);this._w=(r-o)/c,this._x=(h+d)/c,this._y=.25*c,this._z=(l+a)/c}else{let c=2*Math.sqrt(1+u-i-n);this._w=(d-h)/c,this._x=(r+o)/c,this._y=(l+a)/c,this._z=.25*c}return this._onChangeCallback(),this}setFromUnitVectors(t,s){let i=t.dot(s)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*s.z-t.z*s.y,this._y=t.z*s.x-t.x*s.z,this._z=t.x*s.y-t.y*s.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(S(this.dot(t),-1,1)))}rotateTowards(t,s){let i=this.angleTo(t);if(i===0)return this;let h=Math.min(1,s/i);return this.slerp(t,h),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,s){return s!==void 0?(console.warn("Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,s)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,s){let i=t._x,h=t._y,r=t._z,d=t._w,n=s._x,l=s._y,o=s._z,a=s._w;return this._x=i*a+d*n+h*o-r*l,this._y=h*a+d*l+r*n-i*o,this._z=r*a+d*o+i*l-h*n,this._w=d*a-i*n-h*l-r*o,this._onChangeCallback(),this}slerp(t,s){if(s===0)return this;if(s===1)return this.copy(t);let i=this._x,h=this._y,r=this._z,d=this._w,n=d*t._w+i*t._x+h*t._y+r*t._z;if(n<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,n=-n):this.copy(t),n>=1)return this._w=d,this._x=i,this._y=h,this._z=r,this;let l=1-n*n;if(l<=Number.EPSILON){let c=1-s;return this._w=c*d+s*this._w,this._x=c*i+s*this._x,this._y=c*h+s*this._y,this._z=c*r+s*this._z,this.normalize(),this._onChangeCallback(),this}let o=Math.sqrt(l),a=Math.atan2(o,n),u=Math.sin((1-s)*a)/o,x=Math.sin(s*a)/o;return this._w=d*u+this._w*x,this._x=i*u+this._x*x,this._y=h*u+this._y*x,this._z=r*u+this._z*x,this._onChangeCallback(),this}slerpQuaternions(t,s,i){return this.copy(t).slerp(s,i)}random(){let t=Math.random(),s=Math.sqrt(1-t),i=Math.sqrt(t),h=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(s*Math.cos(h),i*Math.sin(r),i*Math.cos(r),s*Math.sin(h))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,s=0){return this._x=t[s],this._y=t[s+1],this._z=t[s+2],this._w=t[s+3],this._onChangeCallback(),this}toArray(t=[],s=0){return t[s]=this._x,t[s+1]=this._y,t[s+2]=this._z,t[s+3]=this._w,t}fromBufferAttribute(t,s){return this._x=t.getX(s),this._y=t.getY(s),this._z=t.getZ(s),this._w=t.getW(s),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}};w.prototype.isQuaternion=!0;var f=class{constructor(t=0,s=0,i=0){this.x=t,this.y=s,this.z=i}set(t,s,i){return i===void 0&&(i=this.z),this.x=t,this.y=s,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,s){switch(t){case 0:this.x=s;break;case 1:this.y=s;break;case 2:this.z=s;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,s){return s!==void 0?(console.warn("Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,s)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,s){return this.x=t.x+s.x,this.y=t.y+s.y,this.z=t.z+s.z,this}addScaledVector(t,s){return this.x+=t.x*s,this.y+=t.y*s,this.z+=t.z*s,this}sub(t,s){return s!==void 0?(console.warn("Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,s)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,s){return this.x=t.x-s.x,this.y=t.y-s.y,this.z=t.z-s.z,this}multiply(t,s){return s!==void 0?(console.warn("Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,s)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,s){return this.x=t.x*s.x,this.y=t.y*s.y,this.z=t.z*s.z,this}applyEuler(t){return t&&t.isEuler||console.error("Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(nt.setFromEuler(t))}applyAxisAngle(t,s){return this.applyQuaternion(nt.setFromAxisAngle(t,s))}applyMatrix3(t){let s=this.x,i=this.y,h=this.z,r=t.elements;return this.x=r[0]*s+r[3]*i+r[6]*h,this.y=r[1]*s+r[4]*i+r[7]*h,this.z=r[2]*s+r[5]*i+r[8]*h,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let s=this.x,i=this.y,h=this.z,r=t.elements,d=1/(r[3]*s+r[7]*i+r[11]*h+r[15]);return this.x=(r[0]*s+r[4]*i+r[8]*h+r[12])*d,this.y=(r[1]*s+r[5]*i+r[9]*h+r[13])*d,this.z=(r[2]*s+r[6]*i+r[10]*h+r[14])*d,this}applyQuaternion(t){let s=this.x,i=this.y,h=this.z,r=t.x,d=t.y,n=t.z,l=t.w,o=l*s+d*h-n*i,a=l*i+n*s-r*h,u=l*h+r*i-d*s,x=-r*s-d*i-n*h;return this.x=o*l+x*-r+a*-n-u*-d,this.y=a*l+x*-d+u*-r-o*-n,this.z=u*l+x*-n+o*-d-a*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let s=this.x,i=this.y,h=this.z,r=t.elements;return this.x=r[0]*s+r[4]*i+r[8]*h,this.y=r[1]*s+r[5]*i+r[9]*h,this.z=r[2]*s+r[6]*i+r[10]*h,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,s){return this.x=Math.max(t.x,Math.min(s.x,this.x)),this.y=Math.max(t.y,Math.min(s.y,this.y)),this.z=Math.max(t.z,Math.min(s.z,this.z)),this}clampScalar(t,s){return this.x=Math.max(t,Math.min(s,this.x)),this.y=Math.max(t,Math.min(s,this.y)),this.z=Math.max(t,Math.min(s,this.z)),this}clampLength(t,s){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(s,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,s){return this.x+=(t.x-this.x)*s,this.y+=(t.y-this.y)*s,this.z+=(t.z-this.z)*s,this}lerpVectors(t,s,i){return this.x=t.x+(s.x-t.x)*i,this.y=t.y+(s.y-t.y)*i,this.z=t.z+(s.z-t.z)*i,this}cross(t,s){return s!==void 0?(console.warn("Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,s)):this.crossVectors(this,t)}crossVectors(t,s){let i=t.x,h=t.y,r=t.z,d=s.x,n=s.y,l=s.z;return this.x=h*l-r*n,this.y=r*d-i*l,this.z=i*n-h*d,this}projectOnVector(t){let s=t.lengthSq();if(s===0)return this.set(0,0,0);let i=t.dot(this)/s;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return B.copy(this).projectOnVector(t),this.sub(B)}reflect(t){return this.sub(B.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let s=Math.sqrt(this.lengthSq()*t.lengthSq());if(s===0)return Math.PI/2;let i=this.dot(t)/s;return Math.acos(S(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let s=this.x-t.x,i=this.y-t.y,h=this.z-t.z;return s*s+i*i+h*h}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,s,i){let h=Math.sin(s)*t;return this.x=h*Math.sin(i),this.y=Math.cos(s)*t,this.z=h*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,s,i){return this.x=t*Math.sin(s),this.y=i,this.z=t*Math.cos(s),this}setFromMatrixPosition(t){let s=t.elements;return this.x=s[12],this.y=s[13],this.z=s[14],this}setFromMatrixScale(t){let s=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),h=this.setFromMatrixColumn(t,2).length();return this.x=s,this.y=i,this.z=h,this}setFromMatrixColumn(t,s){return this.fromArray(t.elements,s*4)}setFromMatrix3Column(t,s){return this.fromArray(t.elements,s*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,s=0){return this.x=t[s],this.y=t[s+1],this.z=t[s+2],this}toArray(t=[],s=0){return t[s]=this.x,t[s+1]=this.y,t[s+2]=this.z,t}fromBufferAttribute(t,s,i){return i!==void 0&&console.warn("Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(s),this.y=t.getY(s),this.z=t.getZ(s),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=(Math.random()-.5)*2,s=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(s),this.y=i*Math.sin(s),this.z=t,this}limit(t=1){this.lengthSq()>t*t&&this.setLength(t)}constrainX(t=0,s=0){this.x<t&&(this.x=t),this.x>s&&(this.x=s)}constrainY(t=0,s=0){this.y<t&&(this.y=t),this.y>s&&(this.y=s)}constrainZ(t=0,s=0){this.z<t&&(this.z=t),this.z>s&&(this.z=s)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};f.prototype.isVector3=!0;var B=new f,nt=new w;var p=(e,t=1)=>{e.lengthSq()>t*t&&e.setLength(t)},j=(e,t=0,s=0)=>{e.x<t&&(e.x=t),e.x>s&&(e.x=s)},G=(e,t=0,s=0)=>{e.y<t&&(e.y=t),e.y>s&&(e.y=s)},K=(e,t=0,s=0)=>{e.z<t&&(e.z=t),e.z>s&&(e.z=s)},Vt={limit:p,constrainX:j,constrainY:G,constrainZ:K};var _=new f,D=class{constructor({distance:t=50,maxSpeed:s=3,maxForce:i=.05}={}){this.distance=t,this.maxSpeed=s,this.maxForce=i,this.enabled=!0}apply(t){if(this.enabled){let s=this.align(t);t.addForce(s)}}align(t){_.set(0,0,0);let s=0,i=this.distance*this.distance;return t.neighbors.forEach(h=>{if(h!==t){let r=t.distanceToSquared(h);r>0&&r<i&&(_.add(h.getVelocity()),s++)}}),s>0&&_.multiplyScalar(1/s),_.lengthSq()>0&&(_.setLength(this.maxSpeed),_.sub(t.getVelocity()),p(_,this.maxForce)),_}};var A=class{constructor({target:t=new f,maxSpeed:s=3.5,maxForce:i=.5,maxDistance:h=100}={}){this.target=t,this.maxSpeed=s,this.maxForce=i,this.maxDistance=h,this.enabled=!0}apply(t){if(this.enabled){let s=this.seek(t);t.addForce(s)}}seek(t){let s=new f().copy(t);s.sub(this.target);let i=s.length();return i<this.maxDistance?s.setLength(this.maxSpeed*(1-i/this.maxDistance)):s.set(0,0,0),s.sub(t.getVelocity()),p(s,this.maxForce),s}};var P=class{constructor({min:t=new f(-1,-1,-1),max:s=new f(1,1,1)}={}){this.min=t,this.max=s,this.enabled=!0}apply(t){this.enabled&&(t.x<=this.min.x&&(t.x=this.min.x,t.velocity.x*=-1),t.y<=this.min.y&&(t.y=this.min.y,t.velocity.y*=-1),t.z<=this.min.z&&this.min.z!==this.max.z&&(t.z=this.min.z,t.velocity.z*=-1),t.x>=this.max.x&&(t.x=this.max.x,t.velocity.x*=-1),t.y>=this.max.y&&(t.y=this.max.y,t.velocity.y*=-1),t.z>=this.max.z&&this.min.z!==this.max.z&&(t.z=this.max.z,t.velocity.z*=-1),this.min.z===this.max.z&&(t.z=this.max.z,t.velocity.z=0))}};var V=new f,W=new f,J=new f,q=class{constructor({distance:t=50,maxSpeed:s=3,maxForce:i=.05}={}){this.distance=t,this.maxSpeed=s,this.maxForce=i,this.enabled=!0}apply(t){if(this.enabled){let s=this.cohesion(t);t.addForce(s)}}cohesion(t){V.set(0,0,0);let s=0,i=this.distance*this.distance;return t.neighbors.forEach(h=>{if(h!==t){let r=t.distanceToSquared(h);r>0&&r<i&&(V.add(h),s++)}}),s>0?(V.multiplyScalar(1/s),this.seek(V,t)):V}seek(t,s){return W.copy(t).sub(s),W.setLength(this.maxSpeed),J.copy(W).sub(s.getVelocity()),p(J,this.maxForce),J}};var I=new f,L=class{constructor({offset:t=0,maxForce:s=.2}={}){this.offset=t,this.maxForce=s,this.enabled=!0}apply(t){if(this.enabled){let s=new f,i=1,h=this.offset===0?t.radius:t.radius*(1-this.offset);t.neighbors.forEach(r=>{if(r!==t&&!r.noCollision){I.copy(t),I.sub(r);let d=I.length(),n=h+r.radius;if(d<n){let l=I.setLength((n-d)/n);s.add(l),i++}}}),s.multiplyScalar(1/i),p(s,this.maxForce),t.addForce(s)}}};var X=class{constructor({min:t=new f(-1,-1,-1),max:s=new f(1,1,1)}={}){this.min=t,this.max=s,this.enabled=!0}apply(t){this.enabled&&(t.x<=this.min.x&&(t.x=this.min.x),t.y<=this.min.y&&(t.y=this.min.y),t.z<=this.min.z&&(t.z=this.min.z),t.x>=this.max.x&&(t.x=this.max.x),t.y>=this.max.y&&(t.y=this.max.y),t.z>=this.max.z&&(t.z=this.max.z))}};var Y=class extends EventTarget{constructor({target:t=new f,maxSpeed:s=3.5,maxForce:i=.5,minDistance:h=0,slowDownDistance:r=100,easing:d=void 0,arriveEnabled:n=!1,arriveDistance:l=.01}={}){super(),this.target=t,this.maxSpeed=s,this.maxForce=i,this.minDistance=h,this.slowDownDistance=r,this.easing=d,this.arriveEnabled=n,this.arriveDistance=l,this.enabled=!0,this.arrived=!1}apply(t){if(this.enabled){let s=this.seek(t);t.addForce(s)}}seek(t){let s=new f().copy(this.target).sub(t),i=s.length();if(i>this.minDistance){if(i<this.minDistance+this.slowDownDistance){let h=(i-this.minDistance)/this.slowDownDistance;this.easing!==void 0&&this.easing!==null?s.setLength(this.maxSpeed*this.easing(h)):s.setLength(this.maxSpeed*h)}else s.setLength(this.maxSpeed);s.sub(t.getVelocity()),p(s,this.maxForce)}else s.set(0,0,0);if(this.arriveEnabled){let h=i<this.arriveDistance;h&&!this.arrived&&(this.dispatchEvent(new Event("arrive")),this.arrived=h)}return s}};var Q=class{constructor({maxSpeed:t=3.5,maxForce:s=.5,min:i=new f(-10,-10,-10),max:h=new f(10,10,10),minDistance:r=.01,slowDownDistance:d=0}={}){this.maxSpeed=t,this.maxForce=s,this.min=i,this.max=h,this.minDistance=r<s?s:r,this.slowDownDistance=d,this.enabled=!0,this.setRandomTarget()}apply(t){if(this.enabled){let s=this.seek(t);t.addForce(s)}}seek(t){let s=new f().copy(this.target);s.sub(t);let i=s.length();return i<=this.minDistance?this.setRandomTarget():i<this.slowDownDistance?s.setLength(this.maxSpeed*i/this.slowDownDistance):s.setLength(this.maxSpeed),s.sub(t.getVelocity()),p(s,this.maxForce),s}setRandomTarget(){this.target=new f(C.randFloat(this.min.x,this.max.x),C.randFloat(this.min.y,this.max.y),C.randFloat(this.min.z,this.max.z))}};var T=new f,Z=class{constructor({distance:t=25,maxSpeed:s=3,maxForce:i=.05}={}){this.distance=t,this.maxSpeed=s,this.maxForce=i,this.enabled=!0}apply(t){if(this.enabled){let s=this.seperate(t);t.addForce(s)}}seperate(t){let s=new f,i=0;return t.neighbors.forEach(h=>{if(h!==t){let r=t.distanceTo(h);r>0&&r<this.distance&&(T.copy(t),T.sub(h),T.setLength(1/r),s.add(T),i++)}}),i>0&&s.multiplyScalar(1/i),s.lengthSq()>0&&(s.setLength(this.maxSpeed),s.sub(t.getVelocity()),p(s,this.maxForce)),s}};var U=class{constructor({speed:t=1,maxChange:s=1,maxForce:i=1}={}){this.speed=t,this.maxChange=s,this.maxForce=i,this.wanderVelocity=new f,this.wanderDirection=new f,this.enabled=!0}apply(t){if(this.enabled){let s=this.wander();t.addForce(s)}}wander(){return this.wanderDirection.normalize(),this.wanderDirection.x+=(Math.random()-.5)*this.maxChange,this.wanderDirection.y+=(Math.random()-.5)*this.maxChange,this.wanderDirection.z+=(Math.random()-.5)*this.maxChange,this.wanderVelocity.set(0,0,0),this.wanderVelocity.add(this.wanderDirection),this.wanderVelocity.multiplyScalar(this.speed),p(this.wanderVelocity,this.maxForce),this.wanderVelocity}};var H=class{constructor({min:t=new f(-1,-1,-1),max:s=new f(1,1,1)}={}){this.min=t,this.max=s,this.enabled=!0}apply(t){this.enabled&&(t.x<this.min.x&&(t.x=this.max.x),t.y<this.min.y&&(t.y=this.max.y),t.z<this.min.z&&(t.z=this.max.z),t.x>this.max.x&&(t.x=this.min.x),t.y>this.max.y&&(t.y=this.min.y),t.z>this.max.z&&(t.z=this.min.z))}};var M=class{constructor({neighborRange:t=100}={}){this.neighborRange=t,this.H=new Map,this.particles=new Set}getXr(t){return Math.floor(t.x/this.neighborRange)}getYr(t){return Math.floor(t.y/this.neighborRange)}getKey(t){return this.getXr(t)+"_"+this.getYr(t)}add(t){this.particles.add(t),this.insert(t)}clear(){this.H.clear(),this.particles.clear()}insert(t){let s=this.getKey(t);if(this.H.get(s)===void 0)this.H.set(s,[t]);else{let i=this.H.get(s);i.push(t),this.H.set(s,i)}}updateAll(){this.H.clear(),this.particles.forEach(t=>{this.insert(t)})}check(t){let s=this.getXr(t),i=this.getYr(t),h=[],r=0;for(let n=s-1;n<=s+1;n++)for(let l=i-1;l<=i+1;l++)h[r++]=n+"_"+l;let d=[];for(r=0;r<h.length;r++)this.H.get(h[r])!==void 0&&(d=d.concat(this.H.get(h[r])));return new Set(d)}delete(t){let s=this.getKey(t);this.H.delete(s),this.particles.delete(t)}size(){return this.H.size}};var N=class extends f{constructor(t=0,s=0,i=0,h=1,r=1){super(t,s,i),this.velocity=new f,this.velocitySmooth=new f,this.locked=!1,this.behaviors=null,this.neighbors=null,this.mass=h,this.radius=r,this.friction=0,this.maxSpeed=3,this.force=new f,this.followers=new Set}addBehavior(t,s=!1){return this.behaviors===null&&(this.behaviors=new Set),(!this.behaviors.has(t)||s)&&this.behaviors.add(t),this}addConstraint(t){return this.behaviors===null&&(this.behaviors=new Set),this.behaviors.add(t),this}addFollower(t){this.followers.add(t)}addForce(t){return this.force.add(t),this}applyBehaviors(){this.behaviors!==null&&this.behaviors.forEach(t=>{t.apply(this)})}applyForce(t){this.velocity.add(this.force.multiplyScalar(Math.min(t,1)/this.mass)),this.velocity.limit(this.maxSpeed),this.add(this.velocity),this.velocitySmooth.lerp(this.velocity,.05),this.force.set(0,0,0)}clearForce(){return this.force.set(0,0,0),this}clearVelocity(){return this.velocity.set(0,0,0),this}getVelocity(){return this.velocity}removeBehavior(t){if(this.behaviors!==null){let s=this.behaviors.has(t);return this.behaviors.delete(t),s}else return!1}removeFollower(t){if(this.followers!==null){let s=this.followers.has(t);return this.followers.delete(t),s}else return!1}scaleVelocity(t){return this.velocity.multiplyScalar(t),this}unlock(){return this.clearVelocity(),this.locked=!1,this}update(t){this.locked||(this.applyBehaviors(),this.applyForce(t)),this.scaleVelocity(1-this.friction),this.followers.forEach(s=>{s.copy(this)})}equalsWithTolerance(t,s){let i=this.x-t.x;return!(isNaN(i)||(i<0?-i:i)>s||(i=this.y-t.y,isNaN(i))||(i<0?-i:i)>s||(i=this.z-t.z,isNaN(i))||(i<0?-i:i)>s)}constrainX(t,s){j(this,t,s)}constrainY(t,s){G(this,t,s)}constrainZ(t,s){K(this,t,s)}};var b=class{constructor({friction:t=.95,springIterationsCount:s=50}={}){this.behaviors=new Set,this.constraints=new Set,this.groups=new Set,this.particles=new Set,this.springs=new Set,this.friction=t,this.springIterationsCount=s}addBehavior(t){this.behaviors.add(t)}addParticle(t){return this.returnIfConstrained(t)}addSpring(t){return this.getSpring(t.a,t.b)===null&&this.springs.add(t),this}addConstraint(t){return this.constraints.add(t),t}addGroup(t){return this.groups.add(t)}clear(){return this.particles.clear(),this.springs.clear(),this}getParticle(t){return this.returnIfConstrained(t)}getSpring(t,s){return this.springs.forEach(i=>{if(i.a===t&&i.b===s||i.a===s&&i.b===t)return i}),null}getnumConnected(t){let s=0;return this.springs!=null&&this.springs.forEach(i=>{(i.a===t||i.b===t)&&s++}),s}hasBehavior(t){return this.behaviors.has(t)}hasConstraint(t){return this.constraints.has(t)}hasGroup(t){return this.groups.has(t)}hasParticle(t){return this.particles.has(t)}hasSpring(t){return this.springs.has(t)}removeBehavior(t){return this.behaviors.delete(t)}removeConstraint(t){return this.constraints.delete(t)}removeParticle(t){return this.particles.delete(t)}removeSpring(t){return this.springs.delete(t)}removeSpringElements(t){return this.removeSpring(t)?this.removeParticle(t.a)&&this.removeParticle(t.b):!1}removeGroup(t){return this.groups.delete(t)}updateParticles(t){this.particles.forEach(s=>{s.neighbors===null&&(s.neighbors=this.particles),this.behaviors.forEach(i=>{i.apply(s)}),s.scaleVelocity(1-this.friction),s.update(t)})}updateSprings(t){if(this.springs!==null)for(let s=this.springIterationsCount;s>0;s--)this.springs.forEach(i=>{i.update(t)})}update(t=1){this.updateParticles(t),this.updateSprings(t),this.groups!==null&&this.groups.forEach(s=>{s.update(t)})}returnIfConstrained(t){return this.constraints.forEach(s=>{if(t.equalsWithTolerance(s,.1))return s}),this.returnIfDuplicate(t)}returnIfDuplicate(t){return this.particles.forEach(s=>{if(t===s)return s}),this.particles.add(t),t}};var R=class extends b{constructor(t){let{neighborRange:s=80}=t;super(t),this.hashgrid=new M({neighborRange:s}),this.neighborsCountAverage=0,this.batchSize=100,this.start=0}addParticle(t){let s=super.addParticle(t);return this.hashgrid.add(s),s}clear(){return super.clear(),this.hashgrid.clear(),this}removeParticle(t){return this.hashgrid.delete(t),super.removeParticle(t)}update(t=1){this.hashgrid.updateAll(),this.neighborsCountAverage=0,this.particles.forEach(s=>{s.neighbors=this.hashgrid.check(s),this.neighborsCountAverage+=s.neighbors.size}),this.neighborsCountAverage/=this.particles.size,this.neighborsCountAverage=Math.round(this.neighborsCountAverage),super.update(t)}};export{D as Align,A as Avoid,P as Bounce,q as Cohesion,L as Collision,X as Constrain,R as GridPhysics,M as HashGrid,C as Math2,N as Particle,w as Quaternion,Y as Seek,Q as SeekRandom,Z as Separate,b as SimplePhysics,Vt as VecUtils,f as Vector3,U as Wander,H as Wrap};
//# sourceMappingURL=particular.js.map
