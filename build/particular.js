var y=[];for(let e=0;e<256;e++)y[e]=(e<16?"0":"")+e.toString(16);var $=1234567,v=Math.PI/180,O=180/Math.PI;function rt(){let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(y[e&255]+y[e>>8&255]+y[e>>16&255]+y[e>>24&255]+"-"+y[t&255]+y[t>>8&255]+"-"+y[t>>16&15|64]+y[t>>24&255]+"-"+y[s&63|128]+y[s>>8&255]+"-"+y[s>>16&255]+y[s>>24&255]+y[i&255]+y[i>>8&255]+y[i>>16&255]+y[i>>24&255]).toLowerCase()}function C(e,t,s){return Math.max(t,Math.min(s,e))}function tt(e,t){return(e%t+t)%t}function ht(e,t,s,i,r){return i+(e-t)*(r-i)/(s-t)}function nt(e,t,s){return e!==t?(s-e)/(t-e):0}function st(e,t,s){return(1-s)*e+s*t}function ot(e,t,s,i){return st(e,t,1-Math.exp(-s*i))}function at(e,t=1){return t-Math.abs(tt(e,t*2)-t)}function ct(e,t=0,s=1){return e<=t?0:e>=s?1:(e=(e-t)/(s-t),e*e*(3-2*e))}function lt(e,t=0,s=1){return e<=t?0:e>=s?1:(e=(e-t)/(s-t),e*e*e*(e*(e*6-15)+10))}function ut(e,t){return e+Math.floor(Math.random()*(t-e+1))}function dt(e,t){return e+Math.random()*(t-e)}function ft(e){return e*(.5-Math.random())}function xt(e){e!==void 0&&($=e);let t=$+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function pt(e){return e*v}function yt(e){return e*O}function mt(e){return(e&e-1)===0&&e!==0}function _t(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function zt(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function gt(e,t,s,i,r){let h=Math.cos,l=Math.sin,n=h(s/2),u=l(s/2),o=h((t+i)/2),a=l((t+i)/2),d=h((t-i)/2),f=l((t-i)/2),c=h((i-t)/2),p=l((i-t)/2);switch(r){case"XYX":e.set(n*a,u*d,u*f,n*o);break;case"YZY":e.set(u*f,n*a,u*d,n*o);break;case"ZXZ":e.set(u*d,u*f,n*a,n*o);break;case"XZX":e.set(n*a,u*p,u*c,n*o);break;case"YXY":e.set(u*c,n*a,u*p,n*o);break;case"ZYZ":e.set(u*p,u*c,n*a,n*o);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function wt(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Mt(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}var V={DEG2RAD:v,RAD2DEG:O,generateUUID:rt,clamp:C,euclideanModulo:tt,mapLinear:ht,inverseLerp:nt,lerp:st,damp:ot,pingpong:at,smoothstep:ct,smootherstep:lt,randInt:ut,randFloat:dt,randFloatSpread:ft,seededRandom:xt,degToRad:pt,radToDeg:yt,isPowerOfTwo:mt,ceilPowerOfTwo:_t,floorPowerOfTwo:zt,setQuaternionFromProperEuler:gt,normalize:Mt,denormalize:wt};var w=class{constructor(t=0,s=0,i=0,r=1){this._x=t,this._y=s,this._z=i,this._w=r}static slerp(t,s,i,r){return console.warn("Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,s,r)}static slerpFlat(t,s,i,r,h,l,n){let u=i[r+0],o=i[r+1],a=i[r+2],d=i[r+3],f=h[l+0],c=h[l+1],p=h[l+2],F=h[l+3];if(n===0){t[s+0]=u,t[s+1]=o,t[s+2]=a,t[s+3]=d;return}if(n===1){t[s+0]=f,t[s+1]=c,t[s+2]=p,t[s+3]=F;return}if(d!==F||u!==f||o!==c||a!==p){let g=1-n,E=u*f+o*c+a*p+d*F,G=E>=0?1:-1,K=1-E*E;if(K>Number.EPSILON){let _=Math.sqrt(K),J=Math.atan2(_,E*G);g=Math.sin(g*J)/_,n=Math.sin(n*J)/_}let D=n*G;if(u=u*g+f*D,o=o*g+c*D,a=a*g+p*D,d=d*g+F*D,g===1-n){let _=1/Math.sqrt(u*u+o*o+a*a+d*d);u*=_,o*=_,a*=_,d*=_}}t[s]=u,t[s+1]=o,t[s+2]=a,t[s+3]=d}static multiplyQuaternionsFlat(t,s,i,r,h,l){let n=i[r],u=i[r+1],o=i[r+2],a=i[r+3],d=h[l],f=h[l+1],c=h[l+2],p=h[l+3];return t[s]=n*p+a*d+u*c-o*f,t[s+1]=u*p+a*f+o*d-n*c,t[s+2]=o*p+a*c+n*f-u*d,t[s+3]=a*p-n*d-u*f-o*c,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,s,i,r){return this._x=t,this._y=s,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,s){if(!(t&&t.isEuler))throw new Error("Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let i=t._x,r=t._y,h=t._z,l=t._order,n=Math.cos,u=Math.sin,o=n(i/2),a=n(r/2),d=n(h/2),f=u(i/2),c=u(r/2),p=u(h/2);switch(l){case"XYZ":this._x=f*a*d+o*c*p,this._y=o*c*d-f*a*p,this._z=o*a*p+f*c*d,this._w=o*a*d-f*c*p;break;case"YXZ":this._x=f*a*d+o*c*p,this._y=o*c*d-f*a*p,this._z=o*a*p-f*c*d,this._w=o*a*d+f*c*p;break;case"ZXY":this._x=f*a*d-o*c*p,this._y=o*c*d+f*a*p,this._z=o*a*p+f*c*d,this._w=o*a*d-f*c*p;break;case"ZYX":this._x=f*a*d-o*c*p,this._y=o*c*d+f*a*p,this._z=o*a*p-f*c*d,this._w=o*a*d+f*c*p;break;case"YZX":this._x=f*a*d+o*c*p,this._y=o*c*d+f*a*p,this._z=o*a*p-f*c*d,this._w=o*a*d-f*c*p;break;case"XZY":this._x=f*a*d-o*c*p,this._y=o*c*d-f*a*p,this._z=o*a*p+f*c*d,this._w=o*a*d+f*c*p;break;default:console.warn("Quaternion: .setFromEuler() encountered an unknown order: "+l)}return s!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,s){let i=s/2,r=Math.sin(i);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){let s=t.elements,i=s[0],r=s[4],h=s[8],l=s[1],n=s[5],u=s[9],o=s[2],a=s[6],d=s[10],f=i+n+d;if(f>0){let c=.5/Math.sqrt(f+1);this._w=.25/c,this._x=(a-u)*c,this._y=(h-o)*c,this._z=(l-r)*c}else if(i>n&&i>d){let c=2*Math.sqrt(1+i-n-d);this._w=(a-u)/c,this._x=.25*c,this._y=(r+l)/c,this._z=(h+o)/c}else if(n>d){let c=2*Math.sqrt(1+n-i-d);this._w=(h-o)/c,this._x=(r+l)/c,this._y=.25*c,this._z=(u+a)/c}else{let c=2*Math.sqrt(1+d-i-n);this._w=(l-r)/c,this._x=(h+o)/c,this._y=(u+a)/c,this._z=.25*c}return this._onChangeCallback(),this}setFromUnitVectors(t,s){let i=t.dot(s)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*s.z-t.z*s.y,this._y=t.z*s.x-t.x*s.z,this._z=t.x*s.y-t.y*s.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(C(this.dot(t),-1,1)))}rotateTowards(t,s){let i=this.angleTo(t);if(i===0)return this;let r=Math.min(1,s/i);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,s){return s!==void 0?(console.warn("Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,s)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,s){let i=t._x,r=t._y,h=t._z,l=t._w,n=s._x,u=s._y,o=s._z,a=s._w;return this._x=i*a+l*n+r*o-h*u,this._y=r*a+l*u+h*n-i*o,this._z=h*a+l*o+i*u-r*n,this._w=l*a-i*n-r*u-h*o,this._onChangeCallback(),this}slerp(t,s){if(s===0)return this;if(s===1)return this.copy(t);let i=this._x,r=this._y,h=this._z,l=this._w,n=l*t._w+i*t._x+r*t._y+h*t._z;if(n<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,n=-n):this.copy(t),n>=1)return this._w=l,this._x=i,this._y=r,this._z=h,this;let u=1-n*n;if(u<=Number.EPSILON){let c=1-s;return this._w=c*l+s*this._w,this._x=c*i+s*this._x,this._y=c*r+s*this._y,this._z=c*h+s*this._z,this.normalize(),this._onChangeCallback(),this}let o=Math.sqrt(u),a=Math.atan2(o,n),d=Math.sin((1-s)*a)/o,f=Math.sin(s*a)/o;return this._w=l*d+this._w*f,this._x=i*d+this._x*f,this._y=r*d+this._y*f,this._z=h*d+this._z*f,this._onChangeCallback(),this}slerpQuaternions(t,s,i){return this.copy(t).slerp(s,i)}random(){let t=Math.random(),s=Math.sqrt(1-t),i=Math.sqrt(t),r=2*Math.PI*Math.random(),h=2*Math.PI*Math.random();return this.set(s*Math.cos(r),i*Math.sin(h),i*Math.cos(h),s*Math.sin(r))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,s=0){return this._x=t[s],this._y=t[s+1],this._z=t[s+2],this._w=t[s+3],this._onChangeCallback(),this}toArray(t=[],s=0){return t[s]=this._x,t[s+1]=this._y,t[s+2]=this._z,t[s+3]=this._w,t}fromBufferAttribute(t,s){return this._x=t.getX(s),this._y=t.getY(s),this._z=t.getZ(s),this._w=t.getW(s),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}};w.prototype.isQuaternion=!0;var x=class{constructor(t=0,s=0,i=0){this.x=t,this.y=s,this.z=i}set(t,s,i){return i===void 0&&(i=this.z),this.x=t,this.y=s,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,s){switch(t){case 0:this.x=s;break;case 1:this.y=s;break;case 2:this.z=s;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,s){return s!==void 0?(console.warn("Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,s)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,s){return this.x=t.x+s.x,this.y=t.y+s.y,this.z=t.z+s.z,this}addScaledVector(t,s){return this.x+=t.x*s,this.y+=t.y*s,this.z+=t.z*s,this}sub(t,s){return s!==void 0?(console.warn("Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,s)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,s){return this.x=t.x-s.x,this.y=t.y-s.y,this.z=t.z-s.z,this}multiply(t,s){return s!==void 0?(console.warn("Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,s)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,s){return this.x=t.x*s.x,this.y=t.y*s.y,this.z=t.z*s.z,this}applyEuler(t){return t&&t.isEuler||console.error("Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(et.setFromEuler(t))}applyAxisAngle(t,s){return this.applyQuaternion(et.setFromAxisAngle(t,s))}applyMatrix3(t){let s=this.x,i=this.y,r=this.z,h=t.elements;return this.x=h[0]*s+h[3]*i+h[6]*r,this.y=h[1]*s+h[4]*i+h[7]*r,this.z=h[2]*s+h[5]*i+h[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let s=this.x,i=this.y,r=this.z,h=t.elements,l=1/(h[3]*s+h[7]*i+h[11]*r+h[15]);return this.x=(h[0]*s+h[4]*i+h[8]*r+h[12])*l,this.y=(h[1]*s+h[5]*i+h[9]*r+h[13])*l,this.z=(h[2]*s+h[6]*i+h[10]*r+h[14])*l,this}applyQuaternion(t){let s=this.x,i=this.y,r=this.z,h=t.x,l=t.y,n=t.z,u=t.w,o=u*s+l*r-n*i,a=u*i+n*s-h*r,d=u*r+h*i-l*s,f=-h*s-l*i-n*r;return this.x=o*u+f*-h+a*-n-d*-l,this.y=a*u+f*-l+d*-h-o*-n,this.z=d*u+f*-n+o*-l-a*-h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let s=this.x,i=this.y,r=this.z,h=t.elements;return this.x=h[0]*s+h[4]*i+h[8]*r,this.y=h[1]*s+h[5]*i+h[9]*r,this.z=h[2]*s+h[6]*i+h[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,s){return this.x=Math.max(t.x,Math.min(s.x,this.x)),this.y=Math.max(t.y,Math.min(s.y,this.y)),this.z=Math.max(t.z,Math.min(s.z,this.z)),this}clampScalar(t,s){return this.x=Math.max(t,Math.min(s,this.x)),this.y=Math.max(t,Math.min(s,this.y)),this.z=Math.max(t,Math.min(s,this.z)),this}clampLength(t,s){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(s,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,s){return this.x+=(t.x-this.x)*s,this.y+=(t.y-this.y)*s,this.z+=(t.z-this.z)*s,this}lerpVectors(t,s,i){return this.x=t.x+(s.x-t.x)*i,this.y=t.y+(s.y-t.y)*i,this.z=t.z+(s.z-t.z)*i,this}cross(t,s){return s!==void 0?(console.warn("Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,s)):this.crossVectors(this,t)}crossVectors(t,s){let i=t.x,r=t.y,h=t.z,l=s.x,n=s.y,u=s.z;return this.x=r*u-h*n,this.y=h*l-i*u,this.z=i*n-r*l,this}projectOnVector(t){let s=t.lengthSq();if(s===0)return this.set(0,0,0);let i=t.dot(this)/s;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return H.copy(this).projectOnVector(t),this.sub(H)}reflect(t){return this.sub(H.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let s=Math.sqrt(this.lengthSq()*t.lengthSq());if(s===0)return Math.PI/2;let i=this.dot(t)/s;return Math.acos(C(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let s=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return s*s+i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,s,i){let r=Math.sin(s)*t;return this.x=r*Math.sin(i),this.y=Math.cos(s)*t,this.z=r*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,s,i){return this.x=t*Math.sin(s),this.y=i,this.z=t*Math.cos(s),this}setFromMatrixPosition(t){let s=t.elements;return this.x=s[12],this.y=s[13],this.z=s[14],this}setFromMatrixScale(t){let s=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=s,this.y=i,this.z=r,this}setFromMatrixColumn(t,s){return this.fromArray(t.elements,s*4)}setFromMatrix3Column(t,s){return this.fromArray(t.elements,s*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,s=0){return this.x=t[s],this.y=t[s+1],this.z=t[s+2],this}toArray(t=[],s=0){return t[s]=this.x,t[s+1]=this.y,t[s+2]=this.z,t}fromBufferAttribute(t,s,i){return i!==void 0&&console.warn("Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(s),this.y=t.getY(s),this.z=t.getZ(s),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=(Math.random()-.5)*2,s=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(s),this.y=i*Math.sin(s),this.z=t,this}limit(t=1){this.lengthSq()>t*t&&this.setLength(t)}constrainX(t=0,s=0){this.x<t&&(this.x=t),this.x>s&&(this.x=s)}constrainY(t=0,s=0){this.y<t&&(this.y=t),this.y>s&&(this.y=s)}constrainZ(t=0,s=0){this.z<t&&(this.z=t),this.z>s&&(this.z=s)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};x.prototype.isVector3=!0;var H=new x,et=new w;var m=(e,t=1)=>{e.lengthSq()>t*t&&e.setLength(t)},N=(e,t=0,s=0)=>{e.x<t&&(e.x=t),e.x>s&&(e.x=s)},R=(e,t=0,s=0)=>{e.y<t&&(e.y=t),e.y>s&&(e.y=s)},j=(e,t=0,s=0)=>{e.z<t&&(e.z=t),e.z>s&&(e.z=s)},bt={limit:m,constrainX:N,constrainY:R,constrainZ:j};var z=new x,A=class{constructor({distance:t=50,maxSpeed:s=3,maxForce:i=.05}={}){this.distance=t,this.maxSpeed=s,this.maxForce=i,this.enabled=!0}apply(t){if(this.enabled){let s=this.align(t);t.addForce(s)}}align(t){z.set(0,0,0);let s=0,i=this.distance*this.distance;return t.neighbors.forEach(r=>{r!==t&&t.distanceToSquared(r)<i&&(z.add(r.getVelocity()),s++)}),s>0&&z.multiplyScalar(1/s),z.lengthSq()>0&&(z.setLength(this.maxSpeed),z.sub(t.getVelocity()),m(z,this.maxForce)),z}};var q=class{constructor({target:t=new x,maxSpeed:s=3.5,maxForce:i=.5,maxDistance:r=100}={}){this.target=t,this.maxSpeed=s,this.maxForce=i,this.maxDistance=r,this.enabled=!0}apply(t){if(this.enabled){let s=this.seek(t);t.addForce(s)}}seek(t){let s=new x().copy(t);s.sub(this.target);let i=s.length();return i<this.maxDistance?s.setLength(this.maxSpeed*(1-i/this.maxDistance)):s.set(0,0,0),s.sub(t.getVelocity()),m(s,this.maxForce),s}};var k=new x,M=new x,W=new x,P=class{constructor({distance:t=50,maxSpeed:s=3,maxForce:i=.05}={}){this.distance=t,this.maxSpeed=s,this.maxForce=i,this.enabled=!0}apply(t){if(this.enabled){let s=this.cohesion(t);t.addForce(s)}}cohesion(t){k.set(0,0,0);let s=0,i=this.distance*this.distance;return t.neighbors.forEach(r=>{if(r!==t){let h=t.distanceToSquared(r);h>0&&h<i&&(k.add(r),s++)}}),s>0?(k.multiplyScalar(1/s),this.seek(k,t)):k}seek(t,s){M.copy(t).sub(s),M.setLength(this.maxSpeed);let i=10;return M.length()<i?M.multiplyScalar(this.maxSpeed*(M.length()/i)):M.multiplyScalar(this.maxSpeed),W.copy(M).sub(s.getVelocity()),m(W,this.maxForce),W}};var I=new x,L=class{constructor({offset:t=0,maxForce:s=.2}={}){this.offset=t,this.maxForce=s,this.enabled=!0}apply(t){if(this.enabled){let s=new x,i=1,r=this.offset===0?t.radius:t.radius*(1-this.offset);t.neighbors.forEach(h=>{if(h!==t&&!h.noCollision){I.copy(t),I.sub(h);let l=I.length(),n=r+h.radius;if(l<n){let u=I.setLength((n-l)/n);s.add(u),i++}}}),s.multiplyScalar(1/i),m(s,this.maxForce),t.addForce(s)}}};var X=class extends EventTarget{constructor({target:t=new x,maxSpeed:s=3.5,maxForce:i=.5,minDistance:r=0,slowDownDistance:h=100,easing:l=void 0,arriveEnabled:n=!1,arriveDistance:u=.01}={}){super(),this.target=t,this.maxSpeed=s,this.maxForce=i,this.minDistance=r,this.slowDownDistance=h,this.easing=l,this.arriveEnabled=n,this.arriveDistance=u,this.enabled=!0,this.arrived=!1}apply(t){if(this.enabled){let s=this.seek(t);t.addForce(s)}}seek(t){let s=new x().copy(this.target).sub(t),i=s.length();if(i>this.minDistance){if(i<this.minDistance+this.slowDownDistance){let r=(i-this.minDistance)/this.slowDownDistance;this.easing!==void 0&&this.easing!==null?s.setLength(this.maxSpeed*this.easing(r)):s.setLength(this.maxSpeed*r)}else s.setLength(this.maxSpeed);s.sub(t.getVelocity()),m(s,this.maxForce)}else s.set(0,0,0);if(this.arriveEnabled){let r=i<this.arriveDistance;r&&!this.arrived&&(this.dispatchEvent(new Event("arrive")),this.arrived=r)}return s}};var Y=class{constructor({maxSpeed:t=3.5,maxForce:s=.5,min:i=new x(-10,-10,-10),max:r=new x(10,10,10),minDistance:h=.01,slowDownDistance:l=0}={}){this.maxSpeed=t,this.maxForce=s,this.min=i,this.max=r,this.minDistance=h<s?s:h,this.slowDownDistance=l,this.enabled=!0,this.setRandomTarget()}apply(t){if(this.enabled){let s=this.seek(t);t.addForce(s)}}seek(t){let s=new x().copy(this.target);s.sub(t);let i=s.length();return i<=this.minDistance?this.setRandomTarget():i<this.slowDownDistance?s.setLength(this.maxSpeed*i/this.slowDownDistance):s.setLength(this.maxSpeed),s.sub(t.getVelocity()),m(s,this.maxForce),s}setRandomTarget(){this.target=new x(V.randFloat(this.min.x,this.max.x),V.randFloat(this.min.y,this.max.y),V.randFloat(this.min.z,this.max.z))}};var Q=new x,T=class{constructor({distance:t=25,maxSpeed:s=3,maxForce:i=.05}={}){this.distance=t,this.maxSpeed=s,this.maxForce=i,this.enabled=!0}apply(t){if(this.enabled){let s=this.seperate(t);t.addForce(s)}}seperate(t){let s=new x,i=0,r=this.distance*this.distance;return t.neighbors.forEach(h=>{if(h!==t){let l=t.distanceToSquared(h);l<r&&l>0&&(Q.copy(t),Q.sub(h),Q.setLength(1/l),s.add(Q),i++),i>0&&s.multiplyScalar(1/i),s.lengthSq()>0&&(s.setLength(this.maxSpeed),s.sub(t.getVelocity()),m(s,this.maxForce))}}),s}};var Z=class{constructor({speed:t=1,maxChange:s=1,maxForce:i=1}={}){this.speed=t,this.maxChange=s,this.maxForce=i,this.wanderVelocity=new x,this.wanderDirection=new x,this.enabled=!0}apply(t){if(this.enabled){let s=this.wander();t.addForce(s)}}wander(){return this.wanderDirection.normalize(),this.wanderDirection.x+=(Math.random()-.5)*this.maxChange,this.wanderDirection.y+=(Math.random()-.5)*this.maxChange,this.wanderDirection.z+=(Math.random()-.5)*this.maxChange,this.wanderVelocity.set(0,0,0),this.wanderVelocity.add(this.wanderDirection),this.wanderVelocity.multiplyScalar(this.speed),m(this.wanderVelocity,this.maxForce),this.wanderVelocity}};var b=class{constructor({neighborRange:t=100}={}){this.neighborRange=t,this.H=new Map,this.particles=new Set}getXr(t){return Math.floor(t.x/this.neighborRange)}getYr(t){return Math.floor(t.y/this.neighborRange)}getKey(t){return this.getXr(t)+"_"+this.getYr(t)}add(t){this.particles.add(t),this.insert(t)}clear(){this.H.clear(),this.particles.clear()}insert(t){let s=this.getKey(t);if(this.H.get(s)===void 0)this.H.set(s,[t]);else{let i=this.H.get(s);i.push(t),this.H.set(s,i)}}updateAll(){this.H.clear(),this.particles.forEach(t=>{this.insert(t)})}check(t){let s=this.getXr(t),i=this.getYr(t),r=[],h=0;for(let n=s-1;n<=s+1;n++)for(let u=i-1;u<=i+1;u++)r[h++]=n+"_"+u;let l=[];for(h=0;h<r.length;h++)this.H.get(r[h])!==void 0&&(l=l.concat(this.H.get(r[h])));return new Set(l)}delete(t){let s=this.getKey(t);this.H.delete(s),this.particles.delete(t)}size(){return this.H.size}};var U=class extends x{constructor(t=0,s=0,i=0,r=1,h=1){super(t,s,i),this.prev=new x(t,s,i),this.temp=new x,this.locked=!1,this.behaviors=null,this.neighbors=null,this.weight=r,this.radius=h,this.friction=0,this.force=new x,this.followers=new Set}addBehavior(t,s=!1){return this.behaviors===null&&(this.behaviors=new Set),(!this.behaviors.has(t)||s)&&this.behaviors.add(t),this}addConstraint(t){return this.behaviors===null&&(this.behaviors=new Set),this.behaviors.add(t),this}addFollower(t){this.followers.add(t)}addForce(t){return this.force.add(t),this}addVelocity(t){return this.prev.sub(t),this}applyBehaviors(){this.behaviors!=null&&this.behaviors.forEach(t=>{t.apply(this)})}applyForce(t){this.temp.copy(this);var s=new x().copy(this);s.sub(this.prev).add(this.force.multiplyScalar(this.weight*Math.min(t,1))),this.add(s),this.prev.copy(this.temp),this.force.set(0,0,0)}clearForce(){return this.force.set(0,0,0),this}clearVelocity(){return this.prev.copy(this),this}getVelocity(){return new x().copy(this).sub(this.prev)}removeBehavior(t){if(this.behaviors!==null){let s=this.behaviors.has(t);return this.behaviors.delete(t),s}else return!1}removeFollower(t){if(this.followers!==null){let s=this.followers.has(t);return this.followers.delete(t),s}else return!1}scaleVelocity(t){return t>0&&this.prev.lerp(this,0+t),this}setVelocity(t){this.prev.copy(this).sub(t)}unlock(){return this.clearVelocity(),this.locked=!1,this}update(t){this.locked||(this.applyBehaviors(),this.applyForce(t)),this.scaleVelocity(this.friction),this.followers.forEach(s=>{s.copy(this)})}equalsWithTolerance(t,s){let i=this.x-t.x;return!(isNaN(i)||(i<0?-i:i)>s||(i=this.y-t.y,isNaN(i))||(i<0?-i:i)>s||(i=this.z-t.z,isNaN(i))||(i<0?-i:i)>s)}constrainX(t,s){N(this,t,s)}constrainY(t,s){R(this,t,s)}constrainZ(t,s){j(this,t,s)}};var S=class{constructor({friction:t=.95,springIterationsCount:s=50}={}){this.behaviors=new Set,this.constraints=new Set,this.groups=new Set,this.particles=new Set,this.springs=new Set,this.friction=t,this.springIterationsCount=s}addBehavior(t){this.behaviors.add(t)}addParticle(t){return this.returnIfConstrained(t)}addSpring(t){return this.getSpring(t.a,t.b)===null&&this.springs.add(t),this}addConstraint(t){return this.constraints.add(t),t}addGroup(t){return this.groups.add(t)}clear(){return this.particles.clear(),this.springs.clear(),this}getParticle(t){return this.returnIfConstrained(t)}getSpring(t,s){return this.springs.forEach(i=>{if(i.a===t&&i.b===s||i.a===s&&i.b===t)return i}),null}getnumConnected(t){let s=0;return this.springs!=null&&this.springs.forEach(i=>{(i.a===t||i.b===t)&&s++}),s}hasBehavior(t){return this.behaviors.has(t)}hasConstraint(t){return this.constraints.has(t)}hasGroup(t){return this.groups.has(t)}hasParticle(t){return this.particles.has(t)}hasSpring(t){return this.springs.has(t)}removeBehavior(t){return this.behaviors.delete(t)}removeConstraint(t){return this.constraints.delete(t)}removeParticle(t){return this.particles.delete(t)}removeSpring(t){return this.springs.delete(t)}removeSpringElements(t){return this.removeSpring(t)?this.removeParticle(t.a)&&this.removeParticle(t.b):!1}removeGroup(t){return this.groups.delete(t)}updateParticles(t){this.particles.forEach(s=>{s.neighbors===null&&(s.neighbors=this.particles),this.behaviors.forEach(i=>{i.apply(s)}),s.scaleVelocity(this.friction),s.update(t)})}updateSprings(t){if(this.springs!==null)for(let s=this.springIterationsCount;s>0;s--)this.springs.forEach(i=>{i.update(t)})}update(t=1){this.updateParticles(t),this.updateSprings(t),this.groups!==null&&this.groups.forEach(s=>{this.group.update(t)})}returnIfConstrained(t){return this.constraints.forEach(s=>{if(t.equalsWithTolerance(s,.1))return s}),this.returnIfDuplicate(t)}returnIfDuplicate(t){return this.particles.forEach(s=>{if(t===s)return s}),this.particles.add(t),t}};var B=class extends S{constructor(t){let{min:s=null,max:i=null,bounce:r=!1,neighborRange:h=80,friction:l=.95,springIterationsCount:n=50}=t;super(t),this.hashgrid=new b({neighborRange:h}),this.box=null,this.neighborsCountAverage=0,this.batchSize=100,this.start=0,s!==null&&i!==null&&(this.box.setBounceSpace(r),this.box.setWrapSpace(!r),this.addBehavior(this.box))}addParticle(t){let s=super.addParticle(t);return this.hashgrid.add(s),s}setBox(t,s){this.box===null?this.box=new WorldBox(t,s):(this.box.setMin(t),this.box.setMax(s))}setBounceSpace(t){this.box!==null&&this.box.setBounceSpace(t)}setWrappedSpace(t){this.box!==null&&this.box.setWrapSpace(t)}clear(){return super.clear(),this.hashgrid.clear(),this}removeParticle(t){return this.hashgrid.delete(t),super.removeParticle(t)}update(t=1){this.hashgrid.updateAll(),this.neighborsCountAverage=0,this.particles.forEach(s=>{s.neighbors=this.hashgrid.check(s),this.neighborsCountAverage+=s.neighbors.size}),this.neighborsCountAverage/=this.particles.size,this.neighborsCountAverage=Math.round(this.neighborsCountAverage),super.update(t)}};export{A as Align,q as Avoid,P as Cohesion,L as Collision,B as GridPhysics,b as HashGrid,V as Math2,U as Particle,w as Quaternion,X as Seek,Y as SeekRandom,T as Separate,S as SimplePhysics,bt as VecUtils,x as Vector3,Z as Wander};
//# sourceMappingURL=particular.js.map
